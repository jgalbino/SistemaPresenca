<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Enviar E-mail com EmailJS e Firebase</title>
    <!-- Importa o script do EmailJS -->
    <script type="text/javascript" src="https://cdn.emailjs.com/dist/email.min.js"></script>
    <!-- Importa o script do Firebase -->
    <script type="text/javascript" src="https://www.gstatic.com/firebasejs/9.18.0/firebase-app.js"></script>
    <script type="text/javascript" src="https://www.gstatic.com/firebasejs/9.18.0/firebase-firestore.js"></script>
    
    <script type="text/javascript">
        // Configuração do Firebase
        var config = {
        	apiKey: "AIzaSyDTVuDV0-cK9Nk6OvRV3IO8f563nPXTjuY",
        	authDomain: "sistemaoctogono.firebaseapp.com",
        	projectId: "sistemaoctogono",
        	storageBucket: "sistemaoctogono.appspot.com",
        	messagingSenderId: "415747300285",
        	appId: "1:415747300285:web:2ae6ae2d51eefc7e1950d4"
        };

        // Inicializa o Firebase
        const app = firebase.initializeApp(config);
        const db = firebase.firestore();

        // Inicializa o EmailJS com seu User ID
        emailjs.init('jTqaJyiSymGuaW1jj'); // Substitua pelo seu User ID do EmailJS

        // Função para buscar e-mail do Firestore e enviar
        function enviarEmail() {
            const serviceID = 'service_djxccyq'; // ID do serviço
            const templateID = 'template_01jpzky'; // ID do template

            // Supondo que você quer um aluno específico (por exemplo, por nome)
            const nomeAluno = 'Pedro Aldeia'; // Altere conforme necessário
            
            // Buscar e-mail do aluno no Firestore
            db.collection("Alunos")
              .where("nome", "==", nomeAluno) // Altere a condição conforme necessário
              .get()
              .then((querySnapshot) => {
                  if (querySnapshot.empty) {
                      alert("Nenhum aluno encontrado com esse nome.");
                      return;
                  }

                  // Pegue o primeiro documento encontrado
                  const doc = querySnapshot.docs[0];
                  const destinatario = doc.data().email; // Obter o e-mail do aluno

                  // Parâmetros para o template
                  const templateParams = {
                      to_email: destinatario,
                      subject: 'Teste de E-mail', // Assunto do e-mail
                      message: 'Mensagem de teste', // Corpo do e-mail
                  };

                  // Enviar o e-mail com EmailJS
                  emailjs.send(serviceID, templateID, templateParams)
                      .then(function (response) {
                          console.log('E-mail enviado com sucesso!', response.status, response.text);
                          alert('E-mail enviado com sucesso!');
                      }, function (error) {
                          console.error('Falha ao enviar o e-mail:', error);
                          alert('Erro ao enviar o e-mail. Veja o console para mais detalhes.');
                      });
              })
              .catch((error) => {
                  console.error("Erro ao buscar aluno:", error);
                  alert("Erro ao buscar aluno. Veja o console para mais detalhes.");
              });
        }
    </script>
</head>
<body>
    <!-- Botão para testar o envio de e-mail -->
    <button onclick="enviarEmail()">Enviar E-mail</button>
</body>
</html>
