<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Contagem de Presenças por Turma</title>
    <!-- Importa o script do Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.0.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.2/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.2/firebase-auth-compat.js"></script>
    
    <script type="text/javascript">
        // Configuração do Firebase
        var config = {
        	apiKey: "AIzaSyDTVuDV0-cK9Nk6OvRV3IO8f563nPXTjuY",
        	authDomain: "sistemaoctogono.firebaseapp.com",
        	projectId: "sistemaoctogono",
        	storageBucket: "sistemaoctogono.appspot.com",
        	messagingSenderId: "415747300285",
        	appId: "1:415747300285:web:2ae6ae2d51eefc7e1950d4"
        };

        // Inicializa o Firebase
        const app = firebase.initializeApp(config);
        const db = firebase.firestore();

        // Função para contar presenças por turma
        function contarPresencasPorTurma() {
            db.collection("Presenças")
              .get()
              .then((querySnapshot) => {
                  const contagemPorTurma = {};

                  // Iterar sobre todos os documentos e contar por turma
                  querySnapshot.forEach((doc) => {
                      const turma = doc.data().turma; // Assumindo que o campo "turma"
                      
                      // Se a turma já estiver no objeto, incrementa; se não, inicializa com 1
                      if (contagemPorTurma[turma]) {
                          contagemPorTurma[turma]++;
                      } else {
                          contagemPorTurma[turma] = 1;
                      }
                  });

                  // Criar uma mensagem para o alerta com a contagem por turma
                  let mensagem = "Contagem de presenças por turma:\n";
                  for (const [turma, contagem] of Object.entries(contagemPorTurma)) {
                      mensagem += `Turma ${turma}: ${contagem}\n`;
                  }

                  alert(mensagem); // Exibe o alerta com a contagem por turma
              })
              .catch((error) => {
                  console.error("Erro ao obter a coleção Presenças:", error);
                  alert("Erro ao contar presenças. Veja o console para mais detalhes.");
              });
        }

function contarPresencasPorPessoa() {
  db.collection("Presenças")
    .get()
    .then((querySnapshot) => {
      const contagemPorPessoa = {};

      // Iterar sobre todos os documentos e contar quantas vezes cada pessoa aparece no campo "presentes"
      querySnapshot.forEach((doc) => {
        const presentes = doc.data().presentes; // Assumindo que "presentes" é um array

        // Checar se "presentes" é um array antes de iterar
        if (Array.isArray(presentes)) {
          presentes.forEach((pessoa) => {
            // Se a pessoa já estiver no objeto, incrementa; se não, inicializa com 1
            if (contagemPorPessoa[pessoa]) {
              contagemPorPessoa[pessoa]++;
            } else {
              contagemPorPessoa[pessoa] = 1;
            }
          });
        } else {
          console.warn(`Campo "presentes" no documento ${doc.id} não é um array`);
        }
      });

      // Criar uma mensagem para o alerta com a contagem por pessoa
      let mensagem = "Contagem de presenças por pessoa:\n";
      for (const [pessoa, contagem] of Object.entries(contagemPorPessoa)) {
        mensagem += `${pessoa}: ${contagem}\n`;
      }

      alert(mensagem); // Exibe o alerta com a contagem por pessoa
    })
    .catch((error) => {
      console.error("Erro ao obter a coleção Presenças:", error);
      alert("Erro ao contar presenças. Veja o console para mais detalhes.");
    });
}
        
    </script>
</head>
<body>
    <!-- Botão para contar presenças por turma -->
    <button onclick="contarPresencasPorTurma(),contarPresencasPorPessoa()">Contar Presenças por Turma</button>
</body>
</html>
